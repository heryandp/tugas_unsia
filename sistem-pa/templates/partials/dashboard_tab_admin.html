<!-- PANEL ADMIN IT -->
<h3 class="sticky-dashboard-header text-dark">Panel Kontrol Super Admin IT</h3>
{% if role == 'admin_it' %}
<ul class="nav nav-tabs" id="adminTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="admin-user-tab" data-bs-toggle="tab" data-bs-target="#admin-user" type="button"
      role="tab">Pegawai</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="admin-setting-tab" data-bs-toggle="tab" data-bs-target="#admin-setting" type="button"
      role="tab">Pengaturan</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="admin-news-tab" data-bs-toggle="tab" data-bs-target="#admin-news" type="button"
      role="tab">Berita</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="admin-gallery-tab" data-bs-toggle="tab" data-bs-target="#admin-gallery" type="button"
      role="tab">Galeri</button>
  </li>
</ul>
<div class="tab-content border border-top-0 p-3 bg-white" id="adminTabContent">
  <div class="tab-pane fade show active" id="admin-user" role="tabpanel">
    <div class="card shadow">
      <div class="card-header bg-dark text-white"><i class="fas fa-user-plus me-2"></i> Tambah Pegawai Baru</div>
      <div class="card-body">
        <button class="btn btn-dark w-100 btn-anim mb-4" data-bs-toggle="modal" data-bs-target="#addUserModal">
          <i class="fas fa-plus me-1"></i> TAMBAH PEGAWAI BARU
        </button>

        <h5 class="fw-bold mb-3">Daftar Pegawai Aktif</h5>
        <ul class="list-group list-group-flush">
          {% for u in pegawai %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
              {% if u['pas_foto'] %}
              <img src="/uploads/{{ u['pas_foto'] }}" width="50" height="50"
                class="rounded-circle me-3 border border-success img-cover-50" loading="lazy">
              {% else %}
              <img src="https://i.pravatar.cc/150?u={{ u['username']|urlencode }}" width="50" height="50"
                class="rounded-circle me-3 border img-cover-50" loading="lazy">
              {% endif %}
              <div>
                <span class="fw-bold text-dark">{{ u['nama_lengkap'] }}</span> <br>
                <small class="text-muted">NIP: {{ u['nip'] }} | User: {{ u['username'] }}</small>
              </div>
            </div>
            <div class="d-flex align-items-center">
              <span class="badge bg-secondary me-3">{{ u['role']|upper }}</span>
              <a href="#" class="btn-edit me-2" title="Edit Data Pegawai" hx-get="/edit_pegawai/{{ u['id'] }}"
                hx-target="#editModal .modal-body" data-bs-toggle="modal" data-bs-target="#editModal">
                <i class="fas fa-edit"></i>
              </a>
              {% if u['id'] != session['user_id'] %}
              <button class="btn btn-link text-danger p-0" title="Hapus Data"
                onclick="setDeleteUrl('/hapus_data/pegawai/{{ u['id'] }}', 'Pegawai: {{ u['nama_lengkap'] }}', this)">
                <i class="fas fa-trash-alt"></i>
              </button>
              {% endif %}
            </div>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
  <div class="tab-pane fade" id="admin-setting" role="tabpanel">
    <div class="card shadow border-success">
      <div class="card-header bg-success text-white"><i class="fas fa-paint-brush me-2"></i> Pengaturan Tampilan &
        Keamanan</div>
      <div class="card-body">
        <form action="/cms_update" method="POST" enctype="multipart/form-data" hx-post="/cms_update" hx-swap="none"
          hx-encoding="multipart/form-data">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="row mb-3">
            <div class="col-6"><label class="small fw-bold">Ganti Logo Web:</label><input type="file" name="logo_web"
                class="form-control form-control-sm"></div>
            <div class="col-6"><label class="small fw-bold">Foto Ketua:</label><input type="file" name="foto_ketua"
                class="form-control form-control-sm"></div>
          </div>
          <div class="mb-3 bg-success bg-opacity-10 p-3 rounded border border-success">
            <label class="fw-bold text-success"><i class="fas fa-image me-2"></i> Logo Pengadilan Agama IKN (Untuk
              Header Surat):</label>
            <input type="file" name="logo_pa_ikn" class="form-control form-control-sm">
            <small class="text-muted d-block mt-1">* Logo ini akan muncul di pojok kiri atas saat download
              Word/PDF</small>
            {% if p.get('logo_pa_ikn') %}
            <small class="text-success d-block mt-1"><i class="fas fa-check-circle me-1"></i> Logo saat ini: <a
                href="{{p['logo_pa_ikn'] }}" target="_blank">Lihat</a></small>
            {% endif %}
          </div>
          <div class="mb-3 bg-primary bg-opacity-10 p-3 rounded border border-primary">
            <label class="fw-bold text-primary"><i class="fas fa-signature me-2"></i> Upload Barcode/Gambar Tanda Tangan
              Digital:</label>
            <input type="file" name="barcode_ttd" class="form-control form-control-sm">
            <small class="text-muted d-block mt-1">* Gambar ini akan muncul di bagian tanda tangan pada Akta
              Cerai</small>
            {% if p.get('barcode_ttd') %}
            <small class="text-primary d-block mt-1"><i class="fas fa-check-circle me-1"></i> Barcode TTD saat ini: <a
                href="{{ p['barcode_ttd'] }}" target="_blank">Lihat</a></small>
            {% endif %}
          </div>
          <div class="mb-2"><label class="small fw-bold">Background Landing Page:</label><input type="file"
              name="bg_landing" class="form-control form-control-sm"></div>
          <div class="mb-2"><label class="small fw-bold">Background Login:</label><input type="file" name="bg_login"
              class="form-control form-control-sm"></div>
          <div class="mb-3"><label class="small fw-bold">Background Dashboard:</label><input type="file"
              name="bg_dashboard" class="form-control form-control-sm"></div>
          <div class="mb-3"><label class="small fw-bold">Background Halaman Verifikasi PIN:</label><input type="file"
              name="bg_verify_pin" class="form-control form-control-sm"></div>
          <div class="mb-2"><label class="small fw-bold">Kata Sambutan Ketua:</label><textarea name="sambutan_ketua"
              class="form-control" rows="3">{{p['sambutan_ketua'] }}</textarea></div>
          <div class="row mb-2">
            <div class="col-6"><label class="small fw-bold">No. Telepon:</label><input type="text" name="no_telp"
                class="form-control form-control-sm" value="{{ p['no_telp'] }}" minlength="8" maxlength="20"></div>
            <div class="col-6"><label class="small fw-bold">Email Kantor:</label><input type="email" name="email_kantor"
                class="form-control form-control-sm" value="{{ p['email_kantor'] }}"></div>
          </div>
          <label class="small fw-bold text-success">Update 5 Foto Galeri Kegiatan:</label>
          <div class="input-group input-group-sm mb-1"><span class="input-group-text">1</span><input type="file"
              name="kegiatan_1" class="form-control"></div>
          <div class="input-group input-group-sm mb-1"><span class="input-group-text">2</span><input type="file"
              name="kegiatan_2" class="form-control"></div>
          <div class="input-group input-group-sm mb-1"><span class="input-group-text">3</span><input type="file"
              name="kegiatan_3" class="form-control"></div>
          <div class="input-group input-group-sm mb-1"><span class="input-group-text">4</span><input type="file"
              name="kegiatan_4" class="form-control"></div>
          <div class="input-group input-group-sm mb-3"><span class="input-group-text">5</span><input type="file"
              name="kegiatan_5" class="form-control"></div>
          <button class="btn btn-success w-100 btn-anim fw-bold">UPDATE SEMUA PENGATURAN</button>
        </form>
      </div>
    </div>
  </div>
  <div class="tab-pane fade" id="admin-news" role="tabpanel">
    <div class="card shadow border-warning">
      <div class="card-header bg-warning text-dark"><i class="fas fa-newspaper me-2"></i> Tambah Berita & Kegiatan
        Terbaru</div>
      <div class="card-body">
        <button class="btn btn-warning w-100 btn-anim fw-bold text-dark" data-bs-toggle="modal"
          data-bs-target="#addNewsModal">
          <i class="fas fa-plus me-1"></i> POSTING BERITA BARU
        </button>
        <hr class="my-4">
        <h6 class="mb-3 fw-bold">Daftar Berita yang Sudah Diposting:</h6>
        <div class="table-responsive">
          <table class="table table-sm table-bordered">
            <thead class="table-dark">
              <tr>
                <th>Judul</th>
                <th>Isi</th>
                <th>Tanggal</th>
                <th width="10%">Hapus</th>
              </tr>
            </thead>
            <tbody id="berita-body">
              {% for b in berita %}
              {% include "partials/berita_row.html" %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="tab-pane fade" id="admin-gallery" role="tabpanel">
    <div class="card shadow border-primary">
      <div class="card-header bg-primary text-white"><i class="fas fa-images me-2"></i> Tambah Galeri Foto Kegiatan
      </div>
      <div class="card-body">
        <button class="btn btn-primary w-100 btn-anim fw-bold" data-bs-toggle="modal" data-bs-target="#addGalleryModal">
          <i class="fas fa-plus me-1"></i> UPLOAD FOTO GALERI
        </button>
        <hr class="my-4">
        <h6 class="mb-3 fw-bold">Daftar Foto Galeri yang Sudah Diupload:</h6>
        <div class="table-responsive">
          <table class="table table-sm table-bordered">
            <thead class="table-dark">
              <tr>
                <th>Preview</th>
                <th>Judul Foto</th>
                <th>Tanggal</th>
                <th width="10%">Hapus</th>
              </tr>
            </thead>
            <tbody id="galeri-body">
              {% for g in galeri %}
              {% include "partials/galeri_row.html" %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Tambah Pegawai -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">Tambah Pegawai Baru</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="/tambah_user" method="POST" enctype="multipart/form-data" hx-post="/tambah_user" hx-swap="none"
          hx-encoding="multipart/form-data"
          hx-on::after-request="this.reset(); bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="mb-2"><label>Username</label><input name="username" class="form-control" required minlength="3"
              maxlength="50"></div>
          <div class="mb-2"><label>Password</label><input name="password" class="form-control" required minlength="4"
              maxlength="64"></div>
          <div class="mb-2"><label>Nama Lengkap</label><input name="nama" class="form-control" required minlength="3"
              maxlength="80"></div>
          <div class="mb-2"><label>NIP</label><input name="nip" class="form-control" required minlength="5"
              maxlength="18" pattern="\d+" inputmode="numeric"></div>
          <div class="mb-3 bg-danger bg-opacity-10 p-2 rounded">
            <label class="fw-bold text-danger"><i class="fas fa-lock me-1"></i> PIN 6 Digit (WAJIB!)</label>
            <input type="text" name="pin_6digit" class="form-control" maxlength="6" minlength="6" pattern="\d{6}"
              inputmode="numeric" placeholder="Contoh: 123456" required>
            <small class="text-muted">* Hanya angka 0-9, untuk verifikasi login</small>
          </div>
          <div class="mb-3">
            <label class="fw-bold text-success"><i class="fas fa-camera me-1"></i> Upload Pas Foto (Opsional)</label>
            <input type="file" name="pas_foto" class="form-control form-control-sm" accept=".jpg,.png,.jpeg">
          </div>
          <div class="mb-3">
            <label class="fw-bold text-primary"><i class="fas fa-file-pdf me-1"></i> Upload PDF SK PNS
              (Opsional)</label>
            <input type="file" name="pdf_sk_pns" class="form-control form-control-sm" accept=".pdf">
          </div>
          <div class="mb-3"><label>Jabatan</label>
            <select name="role" class="form-select">
              <option value="staff">Staff Pelayanan</option>
              <option value="hakim">Hakim</option>
              <option value="panitera">Panitera (Cetak Akta)</option>
              <option value="sekretaris">Sekretaris</option>
              <option value="kassubag">Kassubag</option>
              <option value="ketua">Ketua Pengadilan</option>
              <option value="wakil_ketua">Wakil Ketua</option>
              <option value="admin_it">Admin IT</option>
            </select>
          </div>
          <button class="btn btn-dark w-100 btn-anim">SIMPAN PEGAWAI</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal Tambah Berita -->
<div class="modal fade" id="addNewsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-warning">
        <h5 class="modal-title text-dark">Tambah Berita</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="/tambah_berita" method="POST" enctype="multipart/form-data" hx-post="/tambah_berita"
          hx-target="#berita-body" hx-swap="afterbegin" hx-encoding="multipart/form-data"
          hx-on::after-request="this.reset(); bootstrap.Modal.getInstance(document.getElementById('addNewsModal')).hide();">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="mb-3">
            <label class="fw-bold">Judul Berita</label>
            <input type="text" name="judul" class="form-control" placeholder="Contoh: Rapat Koordinasi Tahunan" required
              minlength="5" maxlength="120">
          </div>
          <div class="mb-3">
            <label class="fw-bold">Isi Berita</label>
            <textarea name="isi" class="form-control" rows="3" placeholder="Tulis isi berita..." required minlength="10"
              maxlength="2000"></textarea>
          </div>
          <div class="mb-3">
            <label class="fw-bold">Upload Foto Berita</label>
            <input type="file" name="gambar" class="form-control" accept=".jpg,.png,.jpeg">
          </div>
          <button class="btn btn-warning w-100 btn-anim fw-bold text-dark">POSTING BERITA</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal Tambah Galeri -->
<div class="modal fade" id="addGalleryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Tambah Foto Galeri</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="/tambah_galeri" method="POST" enctype="multipart/form-data" hx-post="/tambah_galeri"
          hx-target="#galeri-body" hx-swap="afterbegin" hx-encoding="multipart/form-data"
          hx-on::after-request="this.reset(); bootstrap.Modal.getInstance(document.getElementById('addGalleryModal')).hide();">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="mb-3">
            <label class="fw-bold">Judul / Keterangan Foto</label>
            <input type="text" name="judul_foto" class="form-control" placeholder="Contoh: Rapat Pleno Hakim" required
              minlength="3" maxlength="120">
          </div>
          <div class="mb-3">
            <label class="fw-bold">Upload Foto Kegiatan</label>
            <input type="file" name="file_foto" class="form-control" accept=".jpg,.png,.jpeg" required>
            <small class="text-muted">Format: JPG, PNG (Max 2MB)</small>
          </div>
          <button class="btn btn-primary w-100 btn-anim fw-bold">UPLOAD FOTO GALERI</button>
        </form>
      </div>
    </div>
  </div>
</div>

{% else %}
<div class="alert alert-danger">AKSES DITOLAK. HANYA ADMIN IT.</div>
{% endif %}

<!-- Modal Delete Confirmation -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">Konfirmasi Hapus</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Apakah Anda yakin ingin menghapus data ini?</p>
        <p class="fw-bold" id="deleteItemName"></p>
        <small class="text-danger">Tindakan ini tidak dapat dibatalkan.</small>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" class="btn btn-danger btn-anim" id="confirmDeleteBtn" hx-target="#adminTabContent"
          hx-swap="outerHTML"
          onclick="var m = bootstrap.Modal.getInstance(document.getElementById('deleteModal')); if(m) m.hide();">
          <i class="fas fa-trash-alt me-1"></i> Ya, Hapus
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  function setDeleteUrl(url, name, btnCtx) {
    document.getElementById('deleteItemName').textContent = name;
    var btn = document.getElementById('confirmDeleteBtn');
    btn.setAttribute('hx-get', url);
    htmx.process(btn);
    var myModal = new bootstrap.Modal(document.getElementById('deleteModal'));
    myModal.show();
  }
</script>